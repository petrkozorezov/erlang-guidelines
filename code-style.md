# Code style

Набор рекомендаций по подходу к написанию, оформлению и форматированию исходного кода на Erlang.

## Оформление

Предлагаю в большинстве наиболее общих случаев руководствоваться рекомендациями, изложенными [здесь](https://github.com/inaka/erlang_guidelines).

## Форматирование

В проекте и связанных с ним зависимостях применяется подход к форматированию, построенный на паре основных принципов:

 - систематическая предсказуемая индентация, дружественная к текстовым редакторам;
 - уровень вложенности выражения напрямую зависит от его глубины в синтаксическом дереве, при этом начало и окончание (когда применимо) всегда находятся на одном уровне индентации, а содержимое, в случае необходимости разбивки на строки, – на следующем.

Эти принципы по скромному мнению автора сих строк позволяют ускорить просмотр и восприятие кода благодаря построению систематической крупномасштабной структуры и близости к характерным для большинства распространённых языков принципам. Всё это в свою очередь позволяет с меньшими усилиями ориентироваться как в общей и так и в частной структуре, находить и реструктурировать отдельные фрагменты, снизить необходимость в чересчур длинных строках, которые неявно навязываются при использовании Erlang community guidelines.

Удачный по мнению автора пример:

```erlang

-spec persist_suspend_key(Key :: binary(), TxID, Sequence) -> ok when
    TxID :: processing_transaction:id(),
    Sequence :: processing_transaction:sequence().

persist_suspend_key(Key, TxID, Sequence) ->
    ok = register_suspend_key(Key),
    Record = #db_proxy_wakeup{
        wakeup_key = Key,
        tx_id = TxID,
        transaction_log_seq = Sequence
    },
    processing_metric:db_do_write(
        wakeup_key,
        fun() ->
            case gate_db_orm:get(db_proxy_wakeup, Key) of
                undefined ->
                    _ = gate_db_orm:create(db_proxy_wakeup, Record),
                    ok;
                #db_proxy_wakeup{tx_id = TxID} ->
                    ok;
                #db_proxy_wakeup{tx_id = AnotherTxID} ->
                    processing_error:throw(
                        proxy_contract_violated,
                        <<"Wakeup key already bound">>,
                        genlib:format("~s:~p", [Key, AnotherTxID])
                    )
            end
        end
    ).

```

Более конкретные детали, на которые стоит обратить внимание:

 - размер индентации равен **4** пробелам;
 - комфортная длина строк строго не регламентируется, максимальная равна **120** символам.

Прочие рекомендации, явно не упомянутые выше:

 - блоки выражений, которые для простоты восприятия приходится отделять пустыми строками, возможно вместо этого лучше вынести в отдельные функции.

### Исключения

Кроме того, чтобы каждому занятому в проекте программисту было более комфортно, из каждого принципа допускаются незначительные исключения. Список может пополняться.

На текущий момент:

1. Каждый может придерживаться комфортной для него лично длины строк, если она не превышает максимальной.

## Работа с существующим кодом

При возникновении конфликтов с принятым в рамках модуля подходом к форматированию предлагается пересиливать себя что есть мочи и придерживаться оригинального подхода. При создании же новых модулей – хозяин барин.
